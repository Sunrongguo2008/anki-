# Anki 可交互遮挡卡片模板

本模板支持在图片上创建多个可交互的矩形遮挡区域，适用于记忆训练场景。支持桌面端和移动端（AnkiDroid）操作。

## ✨ 主要功能

### 交互功能
- 鼠标/触摸拖拽创建矩形遮挡
- 单击切换遮挡透明度（显示边框 ↔ 完全遮挡）
- 智能序号系统：自动显示当前遮挡顺序
- 双击遮挡序号编辑揭示顺序

### 控制功能
- 创建模式开关（默认关闭）
- 按顺序揭示/隐藏遮挡
- 快捷键支持：
  - `W` 揭示下一个遮挡
  - `Q` 隐藏最新揭示的遮挡

### 移动端优化
- 触摸拖拽创建/移动遮挡
- 长按删除遮挡
- 自适应屏幕尺寸
- 支持虚拟键盘输入序号

## 📥 安装与使用

1. **导入模板**
   - 复制提供的代码到Anki卡片模板的正面
   - 确保卡片包含以下字段：
     - `{{FrontSide}}`（模板正面）
     - `{{Deck}}`（牌组名称）
     - `{{Question}}`（问题字段）
     - `Opinions`（用于存储坐标）

2. **创建遮挡**
   - 点击"开启创建遮挡"按钮进入编辑模式
   - 在图片区域拖拽绘制矩形
   - 右键点击删除遮挡
   - 双击序号修改揭示顺序

3. **保存配置**
   - 点击"复制遮挡区域坐标"按钮
   - 将剪贴板内容粘贴到卡片的`Opinions`字段
   - 格式示例：`4.97,8.23,10.50,6.33,1;22.28,7.81,16.76,4.43,2`

## ⚙️ 技术特性

### 坐标系统
- 百分比存储格式（相对于图片尺寸）
- 自动适应屏幕缩放
- 支持图片尺寸变化自动调整

### 数据持久化
- 坐标信息存储在`Opinions`字段
- 卡片加载时自动恢复遮挡布局
- 剪贴板复制验证机制

## 📱 移动端支持
| 操作         | 桌面端          | 移动端          |
|--------------|----------------|----------------|
| 创建遮挡     | 鼠标拖拽        | 手指拖拽        |
| 移动遮挡     | 拖拽           | 长按+拖拽      |
| 删除遮挡     | 右键点击        | 长按2秒        |
| 编辑序号     | 双击           | 双击+虚拟键盘  |

## ❓ 常见问题

Q: 为什么需要手动粘贴坐标到Opinions字段？\
A: 由于Anki的安全策略限制，自动写入字段需要特殊权限，手动粘贴可保证跨平台兼容性

Q: 如何确保不同设备显示一致？\
A: 采用百分比坐标系统，已处理图片缩放对齐问题

Q: 输入重复序号会怎样？\
A: 系统会自动交换两个遮挡的顺序（如将遮挡A设为2，原遮挡2会自动变为1）

Q: 为什么创建模式默认关闭？\
A: 防止误操作，需要主动点击"开启创建遮挡"按钮才能绘制新区域

## 📜 开发规范
- 纯JavaScript实现，无外部依赖
- 响应式布局设计
- 兼容Anki 2.1.x+
- 通过AnkiDroid 2.16+测试
